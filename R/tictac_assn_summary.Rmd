---
title: "TICTAC gene-disease association summary"
output:
  html_document:
    number_sections: no
    toc: no
  pdf_document:
    toc: no
  always_allow_html: true
editor_options:
  chunk_output_type: console
---

# TICTAC gene-disease association summary

Analysis and summary of gene-disease association file generated by TICTAC workflow.

```{r echo=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE)
base::date()
```

```{r setup, echo=FALSE, message=FALSE}
library(readr)
library(data.table)
library(plotly, quietly=T)
```

## Read input association file

```{r}
gene_disease_assn <- read_csv("data/tictac_genes_disease_associations.csv")
setDT(gene_disease_assn)
sprintf("Unique DOIDs: %d; GSYMBs: %d; assns: %d", gene_disease_assn[, uniqueN(doid)], gene_disease_assn[, uniqueN(gene_symbol)], gene_disease_assn[, uniqueN(`disease-target`)])
```

## Examine distributions of variables

```{r message=FALSE}
knitr::kable(data.frame(nStudy = quantile(gene_disease_assn[, nStudy], seq(0, 1, .25))), format = "simple", align="r", caption="nStudy")
```

```{r message=FALSE}
knitr::kable(data.frame(nPub = quantile(gene_disease_assn[, nPub], seq(0, 1, .25))), format = "simple", align="r", caption="nPub")
```

```{r message=FALSE}
knitr::kable(data.frame(unique_drugs_count = quantile(gene_disease_assn[, unique_drugs_count], seq(0, 1, .25))), format = "simple", align="r", caption="unique_drugs_count")
```

## Publication types

Can we infer types for the many unknowns?

```{r}
gene_disease_assn[, publication_type := as.factor(publication_type)]
pubtype_counts <- gene_disease_assn[, .N, by=publication_type]
pubtype_counts[, Pct := N * 100 / sum(pubtype_counts[, N])]
knitr::kable(pubtype_counts[order(-N)], digits=2)
```

## Histogram of meanRankScore

meanRankScore combines variables of merit.

```{r}
plot_ly(type = "histogram", x = gene_disease_assn$mean_rank_score) %>%
  layout(title = paste0("TICTAC gene-disease associations, meanrankscore"))
```

## Examine top ranked associations.

```{r}
gene_disease_assn <- gene_disease_assn[order(mean_rank, doid, gene_symbol)]
sprintf("Associations with max score (%.1f): %d", gene_disease_assn[, max(mean_rank_score)], gene_disease_assn[mean_rank_score == max(mean_rank_score), .N])
```

## Sample of top ranked associations

```{r}
assn_top <- gene_disease_assn[mean_rank_score >= .99*(max(mean_rank_score))]
knitr::kable(assn_top[sample(1:nrow(assn_top), 20), .(doid, disease_name, gene_symbol, tcrdTargetName, nStudy, nPub, publication_type, unique_drugs_count, mean_rank_score)])
```

## Sample of top ranked associations with publication_type

```{r}
assn_top <- gene_disease_assn[!is.na(publication_type)]
assn_top <- gene_disease_assn[mean_rank_score >= .99*(max(mean_rank_score))]
sprintf("Associations (with publication_type) with max score (%.1f): %d", assn_top[, max(mean_rank_score)], assn_top[mean_rank_score == max(mean_rank_score), .N])
knitr::kable(assn_top[sample(1:nrow(assn_top), 20), .(doid, disease_name, gene_symbol, tcrdTargetName, nStudy, nPub, publication_type, unique_drugs_count, mean_rank_score)][order(-mean_rank_score, -nStudy, -nPub)])
```
